flowchart TD
    A[用户首次交互] --> B[第零阶段：工具适配检查]
    B --> C[检测MCP工具生态状态]
    C --> D[配置时间服务优先级]
    D --> E[确认搜索工具组合]
    E --> F[向用户说明系统状态]
    F --> G{信息是否完整?}
    
    G -->|否| H[智能信息收集]
    H --> I[出发地点]
    H --> J[目的地]
    H --> K[旅游时间]
    H --> L[预算范围]
    H --> M[旅游人数]
    H --> N[个性化需求]
    
    G -->|是| O[1. 获取精确时间基准]
    I & J & K & L & M & N --> O
    
    O --> P{time工具可用?}
    P -->|否| Q[要求用户提供日期]
    P -->|是| R[获取准确时间]
    Q --> S[2. 启用sequential-thinking]
    R --> S
    
    S --> T[3. 深度信息搜集]
    T --> U[searxng网页搜索≥8份]
    T --> V[fetch内容获取]
    T --> W[多语言搜索策略]
    
    U --> X[信息质量验证]
    V --> X
    W --> X
    
    X --> Y[4. 交叉验证与评估]
    Y --> Z[一致性检查]
    Z --> AA[权威性评估]
    AA --> BB[时效性验证]
    
    BB --> CC{5. 交通工具可用?}
    CC -->|是| DD[12306+variflight-mcp查询]
    CC -->|否| EE[提供官方渠道]
    
    DD --> FF{查询成功?}
    FF -->|否| GG[多方案替代查询]
    FF -->|是| HH[选择最佳方案]
    GG --> II[重新核算预算]
    II --> JJ[智能方案对比]
    
    EE --> KK[6. amap路线规划]
    HH --> KK
    JJ --> KK
    
    KK --> LL{地图工具可用?}
    LL -->|是| MM[精确路线规划]
    LL -->|否| NN[基础路线建议]
    
    MM --> OO[7. 天气查询集成]
    NN --> OO
    
    OO --> PP[8. memory-bank经验存储]
    PP --> QQ[9. mcp-server-chart可视化]
    QQ --> RR[生成完整攻略]
    RR --> SS[结构化输出+图表集成]
    SS --> TT[信息源透明化]
    TT --> UU[质量保证标注]
    UU --> VV[持续优化反馈]
